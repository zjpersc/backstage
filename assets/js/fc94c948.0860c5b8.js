/*! For license information please see fc94c948.0860c5b8.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[928122],{603905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>m});var n=r(667294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},f=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(r),f=o,m=p["".concat(l,".").concat(f)]||p[f]||d[f]||a;return r?n.createElement(m,i(i({ref:t},u),{},{components:r})):n.createElement(m,i({ref:t},u))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=f;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=r[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}f.displayName="MDXCreateElement"},504774:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>u});r(827378);var n=r(603905);function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}function a(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}const i={id:"discovery",title:"Azure DevOps Discovery",sidebar_label:"Discovery",description:"Automatically discovering catalog entities from repositories in an Azure DevOps organization"},s=void 0,l={unversionedId:"integrations/azure/discovery",id:"integrations/azure/discovery",title:"Azure DevOps Discovery",description:"Automatically discovering catalog entities from repositories in an Azure DevOps organization",source:"@site/../docs/integrations/azure/discovery.md",sourceDirName:"integrations/azure",slug:"/integrations/azure/discovery",permalink:"/docs/integrations/azure/discovery",draft:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/integrations/azure/discovery.md",tags:[],version:"current",frontMatter:{id:"discovery",title:"Azure DevOps Discovery",sidebar_label:"Discovery",description:"Automatically discovering catalog entities from repositories in an Azure DevOps organization"},sidebar:"docs",previous:{title:"Locations",permalink:"/docs/integrations/azure/locations"},next:{title:"Org Data",permalink:"/docs/integrations/azure/org"}},c={},u=[{value:"Dependencies",id:"dependencies",level:2},{value:"Code Search Feature",id:"code-search-feature",level:3},{value:"Azure Integration",id:"azure-integration",level:3},{value:"Installation",id:"installation",level:2},{value:"Alternative Processor",id:"alternative-processor",level:2}],p={toc:u};function d(e){var{components:t}=e,r=a(e,["components"]);return(0,n.kt)("wrapper",o({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"The Azure DevOps integration has a special entity provider for discovering\ncatalog entities within an Azure DevOps. The provider will crawl your Azure\nDevOps organization and register entities matching the configured path. This can\nbe useful as an alternative to static locations or manually adding things to the\ncatalog."),(0,n.kt)("p",null,"This guide explains how to install and configure the Azure DevOps Entity Provider (recommended) or the Azure DevOps Processor."),(0,n.kt)("h2",o({},{id:"dependencies"}),"Dependencies"),(0,n.kt)("h3",o({},{id:"code-search-feature"}),"Code Search Feature"),(0,n.kt)("p",null,"Azure discovery is driven by the Code Search feature in Azure DevOps, this may not be enabled by default. For Azure\nDevOps Services you can confirm this by looking at the installed extensions in your Organization Settings. For Azure\nDevOps Server you'll find this information in your Collection Settings."),(0,n.kt)("p",null,"If the Code Search extension is not listed then you can install it from the ",(0,n.kt)("a",o({parentName:"p"},{href:"https://marketplace.visualstudio.com/items?itemName=ms.vss-code-search&targetId=f9352dac-ba6e-434e-9241-a848a510ce3f&utm_source=vstsproduct&utm_medium=SearchExtStatus"}),"Visual Studio Marketplace"),"."),(0,n.kt)("h3",o({},{id:"azure-integration"}),"Azure Integration"),(0,n.kt)("p",null,"Setup ",(0,n.kt)("a",o({parentName:"p"},{href:"/docs/integrations/azure/locations"}),"Azure integration")," with ",(0,n.kt)("inlineCode",{parentName:"p"},"host")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"token"),". Host must be ",(0,n.kt)("inlineCode",{parentName:"p"},"dev.azure.com")," for Cloud users, otherwise set this to your on-premise hostname."),(0,n.kt)("h2",o({},{id:"installation"}),"Installation"),(0,n.kt)("p",null,"At your configuration, you add one or more provider configs:"),(0,n.kt)("pre",null,(0,n.kt)("code",o({parentName:"pre"},{className:"language-yaml"}),"# app-config.yaml\ncatalog:\n  providers:\n    azureDevOps:\n      yourProviderId: # identifies your dataset / provider independent of config changes\n        organization: myorg\n        project: myproject\n        repository: service-* # this will match all repos starting with service-*\n        path: /catalog-info.yaml\n        schedule: # optional; same options as in TaskScheduleDefinition\n          # supports cron, ISO duration, \"human duration\" as used in code\n          frequency: { minutes: 30 }\n          # supports ISO duration, \"human duration\" as used in code\n          timeout: { minutes: 3 }\n      yourSecondProviderId: # identifies your dataset / provider independent of config changes\n        organization: myorg\n        project: '*' # this will match all projects\n        repository: '*' # this will match all repos\n        path: /catalog-info.yaml\n      anotherProviderId: # another identifier\n        organization: myorg\n        project: myproject\n        repository: '*' # this will match all repos\n        path: /src/*/catalog-info.yaml # this will search for files deep inside the /src folder\n      yetAnotherProviderId: # guess, what? Another one :)\n        host: selfhostedazure.yourcompany.com\n        organization: myorg\n        project: myproject\n")),(0,n.kt)("p",null,"The parameters available are:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"host:"))," ",(0,n.kt)("em",{parentName:"li"},"(optional)")," Leave empty for Cloud hosted, otherwise set to your self-hosted instance host."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"organization:"))," Your Organization slug (or Collection for on-premise users). Required."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"project:"))," ",(0,n.kt)("em",{parentName:"li"},"(optional)")," Your project slug. Wildcards are supported as show on the examples above. If not set, all projects will be searched. For a project name containing spaces, use both single and double quotes as in ",(0,n.kt)("inlineCode",{parentName:"li"},"project: '\"My Project Name\"'"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"repository:"))," ",(0,n.kt)("em",{parentName:"li"},"(optional)")," The repository name. Wildcards are supported as show on the examples above. If not set, all repositories will be searched."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"path:"))," ",(0,n.kt)("em",{parentName:"li"},"(optional)")," Where to find catalog-info.yaml files. Defaults to /catalog-info.yaml."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"schedule"))," ",(0,n.kt)("em",{parentName:"li"},"(optional)"),":",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"frequency")),":\nHow often you want the task to run. The system does its best to avoid overlapping invocations."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"timeout")),":\nThe maximum amount of time that a single task invocation can take."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"initialDelay"))," ",(0,n.kt)("em",{parentName:"li"},"(optional)"),":\nThe amount of time that should pass before the first invocation happens."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"strong"},"scope"))," ",(0,n.kt)("em",{parentName:"li"},"(optional)"),":\n",(0,n.kt)("inlineCode",{parentName:"li"},"'global'")," or ",(0,n.kt)("inlineCode",{parentName:"li"},"'local'"),". Sets the scope of concurrency control.")))),(0,n.kt)("p",null,(0,n.kt)("em",{parentName:"p"},"Note:")," the path parameter follows the same rules as the search on Azure DevOps\nweb interface. For more details visit the\n",(0,n.kt)("a",o({parentName:"p"},{href:"https://docs.microsoft.com/en-us/azure/devops/project/search/get-started-search?view=azure-devops"}),"official search documentation"),"."),(0,n.kt)("p",null,"As this provider is not one of the default providers, you will first need to install\nthe Azure catalog plugin:"),(0,n.kt)("pre",null,(0,n.kt)("code",o({parentName:"pre"},{className:"language-bash"}),"# From your Backstage root directory\nyarn add --cwd packages/backend @backstage/plugin-catalog-backend-module-azure\n")),(0,n.kt)("p",null,"Once you've done that, you'll also need to add the segment below to ",(0,n.kt)("inlineCode",{parentName:"p"},"packages/backend/src/plugins/catalog.ts"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",o({parentName:"pre"},{className:"language-diff"}),"/* packages/backend/src/plugins/catalog.ts */\n+import { AzureDevOpsEntityProvider } from '@backstage/plugin-catalog-backend-module-azure';\n\nconst builder = await CatalogBuilder.create(env);\n/** ... other processors and/or providers ... */\n+builder.addEntityProvider(\n+  AzureDevOpsEntityProvider.fromConfig(env.config, {\n+    logger: env.logger,\n+    // optional: alternatively, use scheduler with schedule defined in app-config.yaml\n+    schedule: env.scheduler.createScheduledTaskRunner({\n+      frequency: { minutes: 30 },\n+      timeout: { minutes: 3 },\n+    }),\n+    // optional: alternatively, use schedule\n+    scheduler: env.scheduler,\n+  }),\n+);\n")),(0,n.kt)("h2",o({},{id:"alternative-processor"}),"Alternative Processor"),(0,n.kt)("p",null,"As an alternative to the entity provider ",(0,n.kt)("inlineCode",{parentName:"p"},"AzureDevOpsEntityProvider"),", you can still use the ",(0,n.kt)("inlineCode",{parentName:"p"},"AzureDevopsDiscoveryProcessor"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",o({parentName:"pre"},{className:"language-diff"}),"// In packages/backend/src/plugins/catalog.ts\n+import { AzureDevOpsDiscoveryProcessor } from '@backstage/plugin-catalog-backend-module-azure';\n\n export default async function createPlugin(\n   env: PluginEnvironment,\n ): Promise<Router> {\n   const builder = await CatalogBuilder.create(env);\n+  builder.addProcessor(AzureDevOpsDiscoveryProcessor.fromConfig(env.config, { logger: env.logger }));\n")),(0,n.kt)("pre",null,(0,n.kt)("code",o({parentName:"pre"},{className:"language-yaml"}),"catalog:\n  locations:\n    # Scan all repositories for a catalog-info.yaml in the root of the default branch\n    - type: azure-discovery\n      target: https://dev.azure.com/myorg/myproject\n    # Or use a custom pattern for a subset of all repositories with default repository\n    - type: azure-discovery\n      target: https://dev.azure.com/myorg/myproject/_git/service-*\n    # Or use a custom file format and location\n    - type: azure-discovery\n      target: https://dev.azure.com/myorg/myproject/_git/*?path=/src/*/catalog-info.yaml\n")),(0,n.kt)("p",null,"Note the ",(0,n.kt)("inlineCode",{parentName:"p"},"azure-discovery")," type, as this is not a regular ",(0,n.kt)("inlineCode",{parentName:"p"},"url")," processor."),(0,n.kt)("p",null,"When using a custom pattern, the target is composed of five parts:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The base instance URL, ",(0,n.kt)("inlineCode",{parentName:"li"},"https://dev.azure.com")," in this case"),(0,n.kt)("li",{parentName:"ul"},"The organization name which is required, ",(0,n.kt)("inlineCode",{parentName:"li"},"myorg")," in this case"),(0,n.kt)("li",{parentName:"ul"},"The project name which is optional, ",(0,n.kt)("inlineCode",{parentName:"li"},"myproject")," in this case. This defaults to ","*",", which scans all the projects where the token has access to."),(0,n.kt)("li",{parentName:"ul"},"The repository blob to scan, which accepts ","*"," wildcard tokens and must be\nadded after ",(0,n.kt)("inlineCode",{parentName:"li"},"_git/"),". This can simply be ",(0,n.kt)("inlineCode",{parentName:"li"},"*")," to scan all repositories in the\nproject."),(0,n.kt)("li",{parentName:"ul"},"The path within each repository to find the catalog YAML file. This will\nusually be ",(0,n.kt)("inlineCode",{parentName:"li"},"/catalog-info.yaml"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"/src/*/catalog-info.yaml")," or a similar\nvariation for catalog files stored in the root directory of each repository.")))}d.isMDXComponent=!0},862525:e=>{var t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(o){return!1}}()?Object.assign:function(e,a){for(var i,s,l=o(e),c=1;c<arguments.length;c++){for(var u in i=Object(arguments[c]))r.call(i,u)&&(l[u]=i[u]);if(t){s=t(i);for(var p=0;p<s.length;p++)n.call(i,s[p])&&(l[s[p]]=i[s[p]])}}return l}},541535:(e,t,r)=>{var n=r(862525),o=60103,a=60106;var i=60109,s=60110,l=60112;var c=60115,u=60116;if("function"==typeof Symbol&&Symbol.for){var p=Symbol.for;o=p("react.element"),a=p("react.portal"),p("react.fragment"),p("react.strict_mode"),p("react.profiler"),i=p("react.provider"),s=p("react.context"),l=p("react.forward_ref"),p("react.suspense"),c=p("react.memo"),u=p("react.lazy")}var d="function"==typeof Symbol&&Symbol.iterator;function f(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h={};function g(e,t,r){this.props=e,this.context=t,this.refs=h,this.updater=r||m}function y(){}function v(e,t,r){this.props=e,this.context=t,this.refs=h,this.updater=r||m}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(f(85));this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var k=v.prototype=new y;k.constructor=v,n(k,g.prototype),k.isPureReactComponent=!0;var b={current:null},O=Object.prototype.hasOwnProperty,N={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,r){var n,a={},i=null,s=null;if(null!=t)for(n in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)O.call(t,n)&&!N.hasOwnProperty(n)&&(a[n]=t[n]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===a[n]&&(a[n]=l[n]);return{$$typeof:o,type:e,key:i,ref:s,props:a,_owner:b.current}}function j(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var z=/\/+/g;function C(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,r,n,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case o:case a:l=!0}}if(l)return i=i(l=e),e=""===n?"."+C(l,0):n,Array.isArray(i)?(r="",null!=e&&(r=e.replace(z,"$&/")+"/"),P(i,t,r,"",(function(e){return e}))):null!=i&&(j(i)&&(i=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,r+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(z,"$&/")+"/")+e)),t.push(i)),1;if(l=0,n=""===n?".":n+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=n+C(s=e[c],c);l+=P(s,t,r,u,i)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=P(s=s.value,t,r,u=n+C(s,c++),i);else if("object"===s)throw t=""+e,Error(f(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function D(e,t,r){if(null==e)return e;var n=[],o=0;return P(e,n,"","",(function(e){return t.call(r,e,o++)})),n}function A(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var S={current:null};function _(){var e=S.current;if(null===e)throw Error(f(321));return e}},827378:(e,t,r)=>{r(541535)}}]);