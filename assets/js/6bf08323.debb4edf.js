/*! For license information please see 6bf08323.debb4edf.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[326463],{603905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var r=n(667294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},p="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),d=a,g=p["".concat(u,".").concat(d)]||p[d]||f[d]||o;return n?r.createElement(g,i(i({ref:t},c),{},{components:n})):r.createElement(g,i({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7506:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>f,frontMatter:()=>i,metadata:()=>u,toc:()=>c});n(827378);var r=n(603905);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const i={id:"installation",title:"Installation",description:"Installing Kubernetes plugin into Backstage"},s=void 0,u={unversionedId:"features/kubernetes/installation",id:"features/kubernetes/installation",title:"Installation",description:"Installing Kubernetes plugin into Backstage",source:"@site/../docs/features/kubernetes/installation.md",sourceDirName:"features/kubernetes",slug:"/features/kubernetes/installation",permalink:"/docs/features/kubernetes/installation",draft:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/features/kubernetes/installation.md",tags:[],version:"current",frontMatter:{id:"installation",title:"Installation",description:"Installing Kubernetes plugin into Backstage"},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/features/kubernetes/"},next:{title:"Configuration",permalink:"/docs/features/kubernetes/configuration"}},l={},c=[{value:"Adding the Kubernetes frontend plugin",id:"adding-the-kubernetes-frontend-plugin",level:2},{value:"Adding Kubernetes Backend plugin",id:"adding-kubernetes-backend-plugin",level:2},{value:"Custom cluster discovery",id:"custom-cluster-discovery",level:3},{value:"Running Backstage locally",id:"running-backstage-locally",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}],p={toc:c};function f(e){var{components:t}=e,n=o(e,["components"]);return(0,r.kt)("wrapper",a({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The Kubernetes feature is a plugin to Backstage, and it is exposed as a tab when\nviewing entities in the software catalog."),(0,r.kt)("p",null,"If you haven't setup Backstage already, read the\n",(0,r.kt)("a",a({parentName:"p"},{href:"/docs/getting-started/"}),"Getting Started")," guide."),(0,r.kt)("h2",a({},{id:"adding-the-kubernetes-frontend-plugin"}),"Adding the Kubernetes frontend plugin"),(0,r.kt)("p",null,"The first step is to add the Kubernetes frontend plugin to your Backstage\napplication."),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-bash"}),"# From your Backstage root directory\nyarn add --cwd packages/app @backstage/plugin-kubernetes\n")),(0,r.kt)("p",null,'Once the package has been installed, you need to import the plugin in your app\nby adding the "Kubernetes" tab to the respective catalog pages.'),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-tsx"}),'// In packages/app/src/components/catalog/EntityPage.tsx\nimport { EntityKubernetesContent } from \'@backstage/plugin-kubernetes\';\n\n// You can add the tab to any number of pages, the service page is shown as an\n// example here\nconst serviceEntityPage = (\n  <EntityLayout>\n    {/* other tabs... */}\n    <EntityLayout.Route path="/kubernetes" title="Kubernetes">\n      <EntityKubernetesContent refreshIntervalMs={30000} />\n    </EntityLayout.Route>\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Notes:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The optional ",(0,r.kt)("inlineCode",{parentName:"li"},"refreshIntervalMs")," property on the ",(0,r.kt)("inlineCode",{parentName:"li"},"EntityKubernetesContent")," defines the interval in which the content automatically refreshes, if not set this will default to 10 seconds.")),(0,r.kt)("p",null,"That's it! But now, we need the Kubernetes Backend plugin for the frontend to\nwork."),(0,r.kt)("h2",a({},{id:"adding-kubernetes-backend-plugin"}),"Adding Kubernetes Backend plugin"),(0,r.kt)("p",null,"Navigate to ",(0,r.kt)("inlineCode",{parentName:"p"},"packages/backend")," of your Backstage app, and install the\n",(0,r.kt)("inlineCode",{parentName:"p"},"@backstage/plugin-kubernetes-backend")," package."),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-bash"}),"# From your Backstage root directory\nyarn add --cwd packages/backend @backstage/plugin-kubernetes-backend\n")),(0,r.kt)("p",null,"Create a file called ",(0,r.kt)("inlineCode",{parentName:"p"},"kubernetes.ts")," inside ",(0,r.kt)("inlineCode",{parentName:"p"},"packages/backend/src/plugins/")," and\nadd the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-typescript"}),"// In packages/backend/src/plugins/kubernetes.ts\nimport { KubernetesBuilder } from '@backstage/plugin-kubernetes-backend';\nimport { Router } from 'express';\nimport { PluginEnvironment } from '../types';\nimport { CatalogClient } from '@backstage/catalog-client';\n\nexport default async function createPlugin(\n  env: PluginEnvironment,\n): Promise<Router> {\n  const catalogApi = new CatalogClient({ discoveryApi: env.discovery });\n  const { router } = await KubernetesBuilder.createBuilder({\n    logger: env.logger,\n    config: env.config,\n    catalogApi,\n  }).build();\n  return router;\n}\n")),(0,r.kt)("p",null,"And import the plugin to ",(0,r.kt)("inlineCode",{parentName:"p"},"packages/backend/src/index.ts"),". There are three lines\nof code you'll need to add, and they should be added near similar code in your\nexisting Backstage backend."),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-typescript"}),"// In packages/backend/src/index.ts\nimport kubernetes from './plugins/kubernetes';\n// ...\nasync function main() {\n  // ...\n  const kubernetesEnv = useHotMemoize(module, () => createEnv('kubernetes'));\n  // ...\n  apiRouter.use('/kubernetes', await kubernetes(kubernetesEnv));\n")),(0,r.kt)("p",null,"That's it! The Kubernetes frontend and backend have now been added to your\nBackstage app."),(0,r.kt)("h3",a({},{id:"custom-cluster-discovery"}),"Custom cluster discovery"),(0,r.kt)("p",null,"If either existing\n",(0,r.kt)("a",a({parentName:"p"},{href:"https://backstage.io/docs/features/kubernetes/configuration#clusterlocatormethods"}),"cluster locators"),"\ndon't work for your use-case, it is possible to implement a custom\n",(0,r.kt)("a",a({parentName:"p"},{href:"https://backstage.io/docs/reference/plugin-kubernetes-backend.kubernetesclusterssupplier"}),"KubernetesClustersSupplier"),"."),(0,r.kt)("p",null,"Change the following in ",(0,r.kt)("inlineCode",{parentName:"p"},"packages/backend/src/plugins/kubernetes.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-diff"}),"-import { KubernetesBuilder } from '@backstage/plugin-kubernetes-backend';\n+import {\n+  ClusterDetails,\n+  KubernetesBuilder,\n+  KubernetesClustersSupplier,\n+} from '@backstage/plugin-kubernetes-backend';\n import { Router } from 'express';\n import { PluginEnvironment } from '../types';\n+import { Duration } from 'luxon';\n+\n+export class CustomClustersSupplier implements KubernetesClustersSupplier {\n+  constructor(private clusterDetails: ClusterDetails[] = []) {}\n+\n+  static create(refreshInterval: Duration) {\n+    const clusterSupplier = new CustomClustersSupplier();\n+    // setup refresh, e.g. using a copy of https://github.com/backstage/backstage/blob/master/plugins/search-backend-node/src/runPeriodically.ts\n+    runPeriodically(\n+      () => clusterSupplier.refreshClusters(),\n+      refreshInterval.toMillis(),\n+    );\n+    return clusterSupplier;\n+  }\n+\n+  async refreshClusters(): Promise<void> {\n+    this.clusterDetails = []; // fetch from somewhere\n+  }\n+\n+  async getClusters(): Promise<ClusterDetails[]> {\n+    return this.clusterDetails;\n+  }\n+}\n\n export default async function createPlugin(\n   env: PluginEnvironment,\n ): Promise<Router> {\n-  const { router } = await KubernetesBuilder.createBuilder({\n+  const builder = await KubernetesBuilder.createBuilder({\n     logger: env.logger,\n     config: env.config,\n-  }).build();\n+  });\n+  builder.setClusterSupplier(\n+    CustomClustersSupplier.create(Duration.fromObject({ minutes: 60 })),\n+  );\n+  const { router } = await builder.build();\n")),(0,r.kt)("h2",a({},{id:"running-backstage-locally"}),"Running Backstage locally"),(0,r.kt)("p",null,"Start the frontend and the backend app by\n",(0,r.kt)("a",a({parentName:"p"},{href:"/docs/getting-started/running-backstage-locally"}),"running Backstage locally"),"."),(0,r.kt)("h2",a({},{id:"configuration"}),"Configuration"),(0,r.kt)("p",null,"After installing the plugins in the code, you'll need to then\n",(0,r.kt)("a",a({parentName:"p"},{href:"/docs/features/kubernetes/configuration"}),"configure them"),"."),(0,r.kt)("h2",a({},{id:"troubleshooting"}),"Troubleshooting"),(0,r.kt)("p",null,"After installing the plugins in the code, if the Kubernetes information is not\nshowing up, you'll need to ",(0,r.kt)("a",a({parentName:"p"},{href:"/docs/features/kubernetes/troubleshooting"}),"troubleshoot it"),"."))}f.isMDXComponent=!0},862525:e=>{var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(a){return!1}}()?Object.assign:function(e,o){for(var i,s,u=a(e),l=1;l<arguments.length;l++){for(var c in i=Object(arguments[l]))n.call(i,c)&&(u[c]=i[c]);if(t){s=t(i);for(var p=0;p<s.length;p++)r.call(i,s[p])&&(u[s[p]]=i[s[p]])}}return u}},541535:(e,t,n)=>{var r=n(862525),a=60103,o=60106;var i=60109,s=60110,u=60112;var l=60115,c=60116;if("function"==typeof Symbol&&Symbol.for){var p=Symbol.for;a=p("react.element"),o=p("react.portal"),p("react.fragment"),p("react.strict_mode"),p("react.profiler"),i=p("react.provider"),s=p("react.context"),u=p("react.forward_ref"),p("react.suspense"),l=p("react.memo"),c=p("react.lazy")}var f="function"==typeof Symbol&&Symbol.iterator;function d(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function k(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||g}function y(){}function m(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||g}k.prototype.isReactComponent={},k.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(d(85));this.updater.enqueueSetState(this,e,t,"setState")},k.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=k.prototype;var h=m.prototype=new y;h.constructor=m,r(h,k.prototype),h.isPureReactComponent=!0;var v={current:null},w=Object.prototype.hasOwnProperty,O={key:!0,ref:!0,__self:!0,__source:!0};function j(e,t,n){var r,o={},i=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)w.call(t,r)&&!O.hasOwnProperty(r)&&(o[r]=t[r]);var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];o.children=l}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===o[r]&&(o[r]=u[r]);return{$$typeof:a,type:e,key:i,ref:s,props:o,_owner:v.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var P=/\/+/g;function N(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function S(e,t,n,r,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case a:case o:u=!0}}if(u)return i=i(u=e),e=""===r?"."+N(u,0):r,Array.isArray(i)?(n="",null!=e&&(n=e.replace(P,"$&/")+"/"),S(i,t,n,"",(function(e){return e}))):null!=i&&(C(i)&&(i=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,n+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(P,"$&/")+"/")+e)),t.push(i)),1;if(u=0,r=""===r?".":r+":",Array.isArray(e))for(var l=0;l<e.length;l++){var c=r+N(s=e[l],l);u+=S(s,t,n,c,i)}else if(c=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)u+=S(s=s.value,t,n,c=r+N(s,l++),i);else if("object"===s)throw t=""+e,Error(d(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return u}function E(e,t,n){if(null==e)return e;var r=[],a=0;return S(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function x(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var B={current:null};function K(){var e=B.current;if(null===e)throw Error(d(321));return e}},827378:(e,t,n)=>{n(541535)}}]);